extends Node

var threshold = 0.5

# Copyright 2009 by Eric Lengyel

# The following data originates from Eric Lengyel's Transvoxel Algorithm.
# http://transvoxel.org/

var cell_class = [
	0x00, 0x01, 0x01, 0x03, 0x01, 0x03, 0x02, 0x04, 0x01, 0x02, 0x03, 0x04, 0x03, 0x04, 0x04, 0x03,
	0x01, 0x03, 0x02, 0x04, 0x02, 0x04, 0x06, 0x0C, 0x02, 0x05, 0x05, 0x0B, 0x05, 0x0A, 0x07, 0x04,
	0x01, 0x02, 0x03, 0x04, 0x02, 0x05, 0x05, 0x0A, 0x02, 0x06, 0x04, 0x0C, 0x05, 0x07, 0x0B, 0x04,
	0x03, 0x04, 0x04, 0x03, 0x05, 0x0B, 0x07, 0x04, 0x05, 0x07, 0x0A, 0x04, 0x08, 0x0E, 0x0E, 0x03,
	0x01, 0x02, 0x02, 0x05, 0x03, 0x04, 0x05, 0x0B, 0x02, 0x06, 0x05, 0x07, 0x04, 0x0C, 0x0A, 0x04,
	0x03, 0x04, 0x05, 0x0A, 0x04, 0x03, 0x07, 0x04, 0x05, 0x07, 0x08, 0x0E, 0x0B, 0x04, 0x0E, 0x03,
	0x02, 0x06, 0x05, 0x07, 0x05, 0x07, 0x08, 0x0E, 0x06, 0x09, 0x07, 0x0F, 0x07, 0x0F, 0x0E, 0x0D,
	0x04, 0x0C, 0x0B, 0x04, 0x0A, 0x04, 0x0E, 0x03, 0x07, 0x0F, 0x0E, 0x0D, 0x0E, 0x0D, 0x02, 0x01,
	0x01, 0x02, 0x02, 0x05, 0x02, 0x05, 0x06, 0x07, 0x03, 0x05, 0x04, 0x0A, 0x04, 0x0B, 0x0C, 0x04,
	0x02, 0x05, 0x06, 0x07, 0x06, 0x07, 0x09, 0x0F, 0x05, 0x08, 0x07, 0x0E, 0x07, 0x0E, 0x0F, 0x0D,
	0x03, 0x05, 0x04, 0x0B, 0x05, 0x08, 0x07, 0x0E, 0x04, 0x07, 0x03, 0x04, 0x0A, 0x0E, 0x04, 0x03,
	0x04, 0x0A, 0x0C, 0x04, 0x07, 0x0E, 0x0F, 0x0D, 0x0B, 0x0E, 0x04, 0x03, 0x0E, 0x02, 0x0D, 0x01,
	0x03, 0x05, 0x05, 0x08, 0x04, 0x0A, 0x07, 0x0E, 0x04, 0x07, 0x0B, 0x0E, 0x03, 0x04, 0x04, 0x03,
	0x04, 0x0B, 0x07, 0x0E, 0x0C, 0x04, 0x0F, 0x0D, 0x0A, 0x0E, 0x0E, 0x02, 0x04, 0x03, 0x0D, 0x01,
	0x04, 0x07, 0x0A, 0x0E, 0x0B, 0x0E, 0x0E, 0x02, 0x0C, 0x0F, 0x04, 0x0D, 0x04, 0x0D, 0x03, 0x01,
	0x03, 0x04, 0x04, 0x03, 0x04, 0x03, 0x0D, 0x01, 0x04, 0x0D, 0x03, 0x01, 0x03, 0x01, 0x01, 0x00
]

var cell_data = [
	[0x00, []],
	[0x31, [0, 1, 2]],
	[0x62, [0, 1, 2, 3, 4, 5]],
	[0x42, [0, 1, 2, 0, 2, 3]],
	[0x53, [0, 1, 4, 1, 3, 4, 1, 2, 3]],
	[0x73, [0, 1, 2, 0, 2, 3, 4, 5, 6]],
	[0x93, [0, 1, 2, 3, 4, 5, 6, 7, 8]],
	[0x84, [0, 1, 4, 1, 3, 4, 1, 2, 3, 5, 6, 7]],
	[0x84, [0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7]],
	[0xC4, [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]],
	[0x64, [0, 4, 5, 0, 1, 4, 1, 3, 4, 1, 2, 3]],
	[0x64, [0, 5, 4, 0, 4, 1, 1, 4, 3, 1, 3, 2]],
	[0x64, [0, 4, 5, 0, 3, 4, 0, 1, 3, 1, 2, 3]],
	[0x64, [0, 1, 2, 0, 2, 3, 0, 3, 4, 0, 4, 5]],
	[0x75, [0, 1, 2, 0, 2, 3, 0, 3, 4, 0, 4, 5, 0, 5, 6]],
	[0x95, [0, 4, 5, 0, 3, 4, 0, 1, 3, 1, 2, 3, 6, 7, 8]]
]

var vertex_data = [
	[],
	[0x6201, 0x5102, 0x3304],
	[0x6201, 0x2315, 0x4113],
	[0x5102, 0x3304, 0x2315, 0x4113],
	[0x5102, 0x4223, 0x1326],
	[0x3304, 0x6201, 0x4223, 0x1326],
	[0x6201, 0x2315, 0x4113, 0x5102, 0x4223, 0x1326],
	[0x4223, 0x1326, 0x3304, 0x2315, 0x4113],
	[0x4113, 0x8337, 0x4223],
	[0x6201, 0x5102, 0x3304, 0x4223, 0x4113, 0x8337],
	[0x6201, 0x2315, 0x8337, 0x4223],
	[0x5102, 0x3304, 0x2315, 0x8337, 0x4223],
	[0x5102, 0x4113, 0x8337, 0x1326],
	[0x4113, 0x8337, 0x1326, 0x3304, 0x6201],
	[0x6201, 0x2315, 0x8337, 0x1326, 0x5102],
	[0x3304, 0x2315, 0x8337, 0x1326],
	[0x3304, 0x1146, 0x2245],
	[0x6201, 0x5102, 0x1146, 0x2245],
	[0x6201, 0x2315, 0x4113, 0x3304, 0x1146, 0x2245],
	[0x2315, 0x4113, 0x5102, 0x1146, 0x2245],
	[0x5102, 0x4223, 0x1326, 0x3304, 0x1146, 0x2245],
	[0x1146, 0x2245, 0x6201, 0x4223, 0x1326],
	[0x3304, 0x1146, 0x2245, 0x6201, 0x2315, 0x4113, 0x5102, 0x4223, 0x1326],
	[0x4223, 0x1326, 0x1146, 0x2245, 0x2315, 0x4113],
	[0x4223, 0x4113, 0x8337, 0x3304, 0x1146, 0x2245],
	[0x6201, 0x5102, 0x1146, 0x2245, 0x4223, 0x4113, 0x8337],
	[0x4223, 0x6201, 0x2315, 0x8337, 0x3304, 0x1146, 0x2245],
	[0x4223, 0x8337, 0x2315, 0x2245, 0x1146, 0x5102],
	[0x5102, 0x4113, 0x8337, 0x1326, 0x3304, 0x1146, 0x2245],
	[0x4113, 0x8337, 0x1326, 0x1146, 0x2245, 0x6201],
	[0x6201, 0x2315, 0x8337, 0x1326, 0x5102, 0x3304, 0x1146, 0x2245],
	[0x2245, 0x2315, 0x8337, 0x1326, 0x1146],
	[0x2315, 0x2245, 0x8157],
	[0x6201, 0x5102, 0x3304, 0x2315, 0x2245, 0x8157],
	[0x4113, 0x6201, 0x2245, 0x8157],
	[0x2245, 0x8157, 0x4113, 0x5102, 0x3304],
	[0x5102, 0x4223, 0x1326, 0x2315, 0x2245, 0x8157],
	[0x6201, 0x4223, 0x1326, 0x3304, 0x2315, 0x2245, 0x8157],
	[0x6201, 0x2245, 0x8157, 0x4113, 0x5102, 0x4223, 0x1326],
	[0x4223, 0x1326, 0x3304, 0x2245, 0x8157, 0x4113],
	[0x4223, 0x4113, 0x8337, 0x2315, 0x2245, 0x8157],
	[0x6201, 0x5102, 0x3304, 0x4223, 0x4113, 0x8337, 0x2315, 0x2245, 0x8157],
	[0x8337, 0x4223, 0x6201, 0x2245, 0x8157],
	[0x5102, 0x3304, 0x2245, 0x8157, 0x8337, 0x4223],
	[0x5102, 0x4113, 0x8337, 0x1326, 0x2315, 0x2245, 0x8157],
	[0x4113, 0x8337, 0x1326, 0x3304, 0x6201, 0x2315, 0x2245, 0x8157],
	[0x5102, 0x1326, 0x8337, 0x8157, 0x2245, 0x6201],
	[0x8157, 0x8337, 0x1326, 0x3304, 0x2245],
	[0x2315, 0x3304, 0x1146, 0x8157],
	[0x6201, 0x5102, 0x1146, 0x8157, 0x2315],
	[0x3304, 0x1146, 0x8157, 0x4113, 0x6201],
	[0x4113, 0x5102, 0x1146, 0x8157],
	[0x2315, 0x3304, 0x1146, 0x8157, 0x5102, 0x4223, 0x1326],
	[0x1326, 0x4223, 0x6201, 0x2315, 0x8157, 0x1146],
	[0x3304, 0x1146, 0x8157, 0x4113, 0x6201, 0x5102, 0x4223, 0x1326],
	[0x1326, 0x1146, 0x8157, 0x4113, 0x4223],
	[0x2315, 0x3304, 0x1146, 0x8157, 0x4223, 0x4113, 0x8337],
	[0x6201, 0x5102, 0x1146, 0x8157, 0x2315, 0x4223, 0x4113, 0x8337],
	[0x3304, 0x1146, 0x8157, 0x8337, 0x4223, 0x6201],
	[0x4223, 0x5102, 0x1146, 0x8157, 0x8337],
	[0x2315, 0x3304, 0x1146, 0x8157, 0x5102, 0x4113, 0x8337, 0x1326],
	[0x6201, 0x4113, 0x8337, 0x1326, 0x1146, 0x8157, 0x2315],
	[0x6201, 0x3304, 0x1146, 0x8157, 0x8337, 0x1326, 0x5102],
	[0x1326, 0x1146, 0x8157, 0x8337],
	[0x1326, 0x8267, 0x1146],
	[0x6201, 0x5102, 0x3304, 0x1326, 0x8267, 0x1146],
	[0x6201, 0x2315, 0x4113, 0x1326, 0x8267, 0x1146],
	[0x5102, 0x3304, 0x2315, 0x4113, 0x1326, 0x8267, 0x1146],
	[0x5102, 0x4223, 0x8267, 0x1146],
	[0x3304, 0x6201, 0x4223, 0x8267, 0x1146],
	[0x5102, 0x4223, 0x8267, 0x1146, 0x6201, 0x2315, 0x4113],
	[0x1146, 0x8267, 0x4223, 0x4113, 0x2315, 0x3304],
	[0x4113, 0x8337, 0x4223, 0x1326, 0x8267, 0x1146],
	[0x6201, 0x5102, 0x3304, 0x4223, 0x4113, 0x8337, 0x1326, 0x8267, 0x1146],
	[0x6201, 0x2315, 0x8337, 0x4223, 0x1326, 0x8267, 0x1146],
	[0x5102, 0x3304, 0x2315, 0x8337, 0x4223, 0x1326, 0x8267, 0x1146],
	[0x8267, 0x1146, 0x5102, 0x4113, 0x8337],
	[0x6201, 0x4113, 0x8337, 0x8267, 0x1146, 0x3304],
	[0x6201, 0x2315, 0x8337, 0x8267, 0x1146, 0x5102],
	[0x1146, 0x3304, 0x2315, 0x8337, 0x8267],
	[0x3304, 0x1326, 0x8267, 0x2245],
	[0x1326, 0x8267, 0x2245, 0x6201, 0x5102],
	[0x3304, 0x1326, 0x8267, 0x2245, 0x6201, 0x2315, 0x4113],
	[0x1326, 0x8267, 0x2245, 0x2315, 0x4113, 0x5102],
	[0x5102, 0x4223, 0x8267, 0x2245, 0x3304],
	[0x6201, 0x4223, 0x8267, 0x2245],
	[0x5102, 0x4223, 0x8267, 0x2245, 0x3304, 0x6201, 0x2315, 0x4113],
	[0x4113, 0x4223, 0x8267, 0x2245, 0x2315],
	[0x3304, 0x1326, 0x8267, 0x2245, 0x4223, 0x4113, 0x8337],
	[0x1326, 0x8267, 0x2245, 0x6201, 0x5102, 0x4223, 0x4113, 0x8337],
	[0x3304, 0x1326, 0x8267, 0x2245, 0x4223, 0x6201, 0x2315, 0x8337],
	[0x5102, 0x1326, 0x8267, 0x2245, 0x2315, 0x8337, 0x4223],
	[0x3304, 0x2245, 0x8267, 0x8337, 0x4113, 0x5102],
	[0x8337, 0x8267, 0x2245, 0x6201, 0x4113],
	[0x5102, 0x6201, 0x2315, 0x8337, 0x8267, 0x2245, 0x3304],
	[0x2315, 0x8337, 0x8267, 0x2245],
	[0x2315, 0x2245, 0x8157, 0x1326, 0x8267, 0x1146],
	[0x6201, 0x5102, 0x3304, 0x2315, 0x2245, 0x8157, 0x1326, 0x8267, 0x1146],
	[0x6201, 0x2245, 0x8157, 0x4113, 0x1326, 0x8267, 0x1146],
	[0x2245, 0x8157, 0x4113, 0x5102, 0x3304, 0x1326, 0x8267, 0x1146],
	[0x4223, 0x8267, 0x1146, 0x5102, 0x2315, 0x2245, 0x8157],
	[0x3304, 0x6201, 0x4223, 0x8267, 0x1146, 0x2315, 0x2245, 0x8157],
	[0x4223, 0x8267, 0x1146, 0x5102, 0x6201, 0x2245, 0x8157, 0x4113],
	[0x3304, 0x2245, 0x8157, 0x4113, 0x4223, 0x8267, 0x1146],
	[0x4223, 0x4113, 0x8337, 0x2315, 0x2245, 0x8157, 0x1326, 0x8267, 0x1146],
	[0x6201, 0x5102, 0x3304, 0x4223, 0x4113, 0x8337, 0x2315, 0x2245, 0x8157, 0x1326, 0x8267, 0x1146],
	[0x8337, 0x4223, 0x6201, 0x2245, 0x8157, 0x1326, 0x8267, 0x1146],
	[0x4223, 0x5102, 0x3304, 0x2245, 0x8157, 0x8337, 0x1326, 0x8267, 0x1146],
	[0x8267, 0x1146, 0x5102, 0x4113, 0x8337, 0x2315, 0x2245, 0x8157],
	[0x6201, 0x4113, 0x8337, 0x8267, 0x1146, 0x3304, 0x2315, 0x2245, 0x8157],
	[0x8337, 0x8267, 0x1146, 0x5102, 0x6201, 0x2245, 0x8157],
	[0x3304, 0x2245, 0x8157, 0x8337, 0x8267, 0x1146],
	[0x8157, 0x2315, 0x3304, 0x1326, 0x8267],
	[0x8267, 0x8157, 0x2315, 0x6201, 0x5102, 0x1326],
	[0x8267, 0x1326, 0x3304, 0x6201, 0x4113, 0x8157],
	[0x8267, 0x8157, 0x4113, 0x5102, 0x1326],
	[0x5102, 0x4223, 0x8267, 0x8157, 0x2315, 0x3304],
	[0x2315, 0x6201, 0x4223, 0x8267, 0x8157],
	[0x3304, 0x5102, 0x4223, 0x8267, 0x8157, 0x4113, 0x6201],
	[0x4113, 0x4223, 0x8267, 0x8157],
	[0x8157, 0x2315, 0x3304, 0x1326, 0x8267, 0x4223, 0x4113, 0x8337],
	[0x8157, 0x2315, 0x6201, 0x5102, 0x1326, 0x8267, 0x4223, 0x4113, 0x8337],
	[0x8157, 0x8337, 0x4223, 0x6201, 0x3304, 0x1326, 0x8267],
	[0x5102, 0x1326, 0x8267, 0x8157, 0x8337, 0x4223],
	[0x8267, 0x8157, 0x2315, 0x3304, 0x5102, 0x4113, 0x8337],
	[0x6201, 0x4113, 0x8337, 0x8267, 0x8157, 0x2315],
	[0x6201, 0x3304, 0x5102, 0x8337, 0x8267, 0x8157],
	[0x8337, 0x8267, 0x8157],
	[0x8337, 0x8157, 0x8267],
	[0x6201, 0x5102, 0x3304, 0x8337, 0x8157, 0x8267],
	[0x6201, 0x2315, 0x4113, 0x8337, 0x8157, 0x8267],
	[0x5102, 0x3304, 0x2315, 0x4113, 0x8337, 0x8157, 0x8267],
	[0x5102, 0x4223, 0x1326, 0x8337, 0x8157, 0x8267],
	[0x6201, 0x4223, 0x1326, 0x3304, 0x8337, 0x8157, 0x8267],
	[0x6201, 0x2315, 0x4113, 0x5102, 0x4223, 0x1326, 0x8337, 0x8157, 0x8267],
	[0x4223, 0x1326, 0x3304, 0x2315, 0x4113, 0x8337, 0x8157, 0x8267],
	[0x4113, 0x8157, 0x8267, 0x4223],
	[0x4223, 0x4113, 0x8157, 0x8267, 0x6201, 0x5102, 0x3304],
	[0x8157, 0x8267, 0x4223, 0x6201, 0x2315],
	[0x3304, 0x2315, 0x8157, 0x8267, 0x4223, 0x5102],
	[0x1326, 0x5102, 0x4113, 0x8157, 0x8267],
	[0x8157, 0x4113, 0x6201, 0x3304, 0x1326, 0x8267],
	[0x1326, 0x5102, 0x6201, 0x2315, 0x8157, 0x8267],
	[0x8267, 0x1326, 0x3304, 0x2315, 0x8157],
	[0x3304, 0x1146, 0x2245, 0x8337, 0x8157, 0x8267],
	[0x6201, 0x5102, 0x1146, 0x2245, 0x8337, 0x8157, 0x8267],
	[0x6201, 0x2315, 0x4113, 0x3304, 0x1146, 0x2245, 0x8337, 0x8157, 0x8267],
	[0x2315, 0x4113, 0x5102, 0x1146, 0x2245, 0x8337, 0x8157, 0x8267],
	[0x5102, 0x4223, 0x1326, 0x3304, 0x1146, 0x2245, 0x8337, 0x8157, 0x8267],
	[0x1146, 0x2245, 0x6201, 0x4223, 0x1326, 0x8337, 0x8157, 0x8267],
	[0x6201, 0x2315, 0x4113, 0x5102, 0x4223, 0x1326, 0x3304, 0x1146, 0x2245, 0x8337, 0x8157, 0x8267],
	[0x4113, 0x4223, 0x1326, 0x1146, 0x2245, 0x2315, 0x8337, 0x8157, 0x8267],
	[0x4223, 0x4113, 0x8157, 0x8267, 0x3304, 0x1146, 0x2245],
	[0x6201, 0x5102, 0x1146, 0x2245, 0x4223, 0x4113, 0x8157, 0x8267],
	[0x8157, 0x8267, 0x4223, 0x6201, 0x2315, 0x3304, 0x1146, 0x2245],
	[0x2315, 0x8157, 0x8267, 0x4223, 0x5102, 0x1146, 0x2245],
	[0x1326, 0x5102, 0x4113, 0x8157, 0x8267, 0x3304, 0x1146, 0x2245],
	[0x1326, 0x1146, 0x2245, 0x6201, 0x4113, 0x8157, 0x8267],
	[0x5102, 0x6201, 0x2315, 0x8157, 0x8267, 0x1326, 0x3304, 0x1146, 0x2245],
	[0x1326, 0x1146, 0x2245, 0x2315, 0x8157, 0x8267],
	[0x2315, 0x2245, 0x8267, 0x8337],
	[0x2315, 0x2245, 0x8267, 0x8337, 0x6201, 0x5102, 0x3304],
	[0x4113, 0x6201, 0x2245, 0x8267, 0x8337],
	[0x5102, 0x4113, 0x8337, 0x8267, 0x2245, 0x3304],
	[0x2315, 0x2245, 0x8267, 0x8337, 0x5102, 0x4223, 0x1326],
	[0x6201, 0x4223, 0x1326, 0x3304, 0x8337, 0x2315, 0x2245, 0x8267],
	[0x4113, 0x6201, 0x2245, 0x8267, 0x8337, 0x5102, 0x4223, 0x1326],
	[0x4113, 0x4223, 0x1326, 0x3304, 0x2245, 0x8267, 0x8337],
	[0x2315, 0x2245, 0x8267, 0x4223, 0x4113],
	[0x2315, 0x2245, 0x8267, 0x4223, 0x4113, 0x6201, 0x5102, 0x3304],
	[0x6201, 0x2245, 0x8267, 0x4223],
	[0x3304, 0x2245, 0x8267, 0x4223, 0x5102],
	[0x5102, 0x4113, 0x2315, 0x2245, 0x8267, 0x1326],
	[0x4113, 0x2315, 0x2245, 0x8267, 0x1326, 0x3304, 0x6201],
	[0x5102, 0x6201, 0x2245, 0x8267, 0x1326],
	[0x3304, 0x2245, 0x8267, 0x1326],
	[0x8267, 0x8337, 0x2315, 0x3304, 0x1146],
	[0x5102, 0x1146, 0x8267, 0x8337, 0x2315, 0x6201],
	[0x3304, 0x1146, 0x8267, 0x8337, 0x4113, 0x6201],
	[0x8337, 0x4113, 0x5102, 0x1146, 0x8267],
	[0x8267, 0x8337, 0x2315, 0x3304, 0x1146, 0x5102, 0x4223, 0x1326],
	[0x1146, 0x8267, 0x8337, 0x2315, 0x6201, 0x4223, 0x1326],
	[0x8267, 0x8337, 0x4113, 0x6201, 0x3304, 0x1146, 0x5102, 0x4223, 0x1326],
	[0x4113, 0x4223, 0x1326, 0x1146, 0x8267, 0x8337],
	[0x3304, 0x2315, 0x4113, 0x4223, 0x8267, 0x1146],
	[0x2315, 0x6201, 0x5102, 0x1146, 0x8267, 0x4223, 0x4113],
	[0x1146, 0x8267, 0x4223, 0x6201, 0x3304],
	[0x5102, 0x1146, 0x8267, 0x4223],
	[0x8267, 0x1326, 0x5102, 0x4113, 0x2315, 0x3304, 0x1146],
	[0x6201, 0x4113, 0x2315, 0x1326, 0x1146, 0x8267],
	[0x6201, 0x3304, 0x1146, 0x8267, 0x1326, 0x5102],
	[0x1326, 0x1146, 0x8267],
	[0x1326, 0x8337, 0x8157, 0x1146],
	[0x8337, 0x8157, 0x1146, 0x1326, 0x6201, 0x5102, 0x3304],
	[0x8337, 0x8157, 0x1146, 0x1326, 0x6201, 0x2315, 0x4113],
	[0x4113, 0x5102, 0x3304, 0x2315, 0x1326, 0x8337, 0x8157, 0x1146],
	[0x8337, 0x8157, 0x1146, 0x5102, 0x4223],
	[0x6201, 0x4223, 0x8337, 0x8157, 0x1146, 0x3304],
	[0x8337, 0x8157, 0x1146, 0x5102, 0x4223, 0x6201, 0x2315, 0x4113],
	[0x4223, 0x8337, 0x8157, 0x1146, 0x3304, 0x2315, 0x4113],
	[0x4223, 0x4113, 0x8157, 0x1146, 0x1326],
	[0x4223, 0x4113, 0x8157, 0x1146, 0x1326, 0x6201, 0x5102, 0x3304],
	[0x1146, 0x8157, 0x2315, 0x6201, 0x4223, 0x1326],
	[0x4223, 0x5102, 0x3304, 0x2315, 0x8157, 0x1146, 0x1326],
	[0x4113, 0x8157, 0x1146, 0x5102],
	[0x6201, 0x4113, 0x8157, 0x1146, 0x3304],
	[0x2315, 0x8157, 0x1146, 0x5102, 0x6201],
	[0x2315, 0x8157, 0x1146, 0x3304],
	[0x2245, 0x3304, 0x1326, 0x8337, 0x8157],
	[0x6201, 0x2245, 0x8157, 0x8337, 0x1326, 0x5102],
	[0x2245, 0x3304, 0x1326, 0x8337, 0x8157, 0x6201, 0x2315, 0x4113],
	[0x2245, 0x2315, 0x4113, 0x5102, 0x1326, 0x8337, 0x8157],
	[0x4223, 0x8337, 0x8157, 0x2245, 0x3304, 0x5102],
	[0x8157, 0x2245, 0x6201, 0x4223, 0x8337],
	[0x2245, 0x3304, 0x5102, 0x4223, 0x8337, 0x8157, 0x4113, 0x6201, 0x2315],
	[0x4223, 0x8337, 0x8157, 0x2245, 0x2315, 0x4113],
	[0x4113, 0x8157, 0x2245, 0x3304, 0x1326, 0x4223],
	[0x1326, 0x4223, 0x4113, 0x8157, 0x2245, 0x6201, 0x5102],
	[0x8157, 0x2245, 0x3304, 0x1326, 0x4223, 0x6201, 0x2315],
	[0x5102, 0x1326, 0x4223, 0x2315, 0x8157, 0x2245],
	[0x3304, 0x5102, 0x4113, 0x8157, 0x2245],
	[0x4113, 0x8157, 0x2245, 0x6201],
	[0x5102, 0x6201, 0x2315, 0x8157, 0x2245, 0x3304],
	[0x2315, 0x8157, 0x2245],
	[0x1146, 0x1326, 0x8337, 0x2315, 0x2245],
	[0x1146, 0x1326, 0x8337, 0x2315, 0x2245, 0x6201, 0x5102, 0x3304],
	[0x6201, 0x2245, 0x1146, 0x1326, 0x8337, 0x4113],
	[0x2245, 0x1146, 0x1326, 0x8337, 0x4113, 0x5102, 0x3304],
	[0x5102, 0x1146, 0x2245, 0x2315, 0x8337, 0x4223],
	[0x1146, 0x3304, 0x6201, 0x4223, 0x8337, 0x2315, 0x2245],
	[0x8337, 0x4113, 0x6201, 0x2245, 0x1146, 0x5102, 0x4223],
	[0x4223, 0x8337, 0x4113, 0x3304, 0x2245, 0x1146],
	[0x4113, 0x2315, 0x2245, 0x1146, 0x1326, 0x4223],
	[0x1146, 0x1326, 0x4223, 0x4113, 0x2315, 0x2245, 0x6201, 0x5102, 0x3304],
	[0x1326, 0x4223, 0x6201, 0x2245, 0x1146],
	[0x4223, 0x5102, 0x3304, 0x2245, 0x1146, 0x1326],
	[0x2245, 0x1146, 0x5102, 0x4113, 0x2315],
	[0x4113, 0x2315, 0x2245, 0x1146, 0x3304, 0x6201],
	[0x6201, 0x2245, 0x1146, 0x5102],
	[0x3304, 0x2245, 0x1146],
	[0x3304, 0x1326, 0x8337, 0x2315],
	[0x5102, 0x1326, 0x8337, 0x2315, 0x6201],
	[0x6201, 0x3304, 0x1326, 0x8337, 0x4113],
	[0x5102, 0x1326, 0x8337, 0x4113],
	[0x4223, 0x8337, 0x2315, 0x3304, 0x5102],
	[0x6201, 0x4223, 0x8337, 0x2315],
	[0x3304, 0x5102, 0x4223, 0x8337, 0x4113, 0x6201],
	[0x4113, 0x4223, 0x8337],
	[0x4113, 0x2315, 0x3304, 0x1326, 0x4223],
	[0x1326, 0x4223, 0x4113, 0x2315, 0x6201, 0x5102],
	[0x3304, 0x1326, 0x4223, 0x6201],
	[0x5102, 0x1326, 0x4223],
	[0x5102, 0x4113, 0x2315, 0x3304],
	[0x6201, 0x4113, 0x2315],
	[0x6201, 0x3304, 0x5102],
	[]
]

func draw_cube(v: Array, d: Array, verts: PoolVector3Array, normals: PoolVector3Array):
	var tag = 0x00000000;
	var idx = [0, 1, 4, 5, 2, 3, 6, 7]

	for i in range(8):
		if d[idx[i]] >= threshold:
			tag |= (1 << i)

	var cell = cell_data[cell_class[tag]]
	var tri_count = cell[0] & 0x0F

	for i in range(tri_count):
		var a = find_vert(vertex_data[tag][cell[1][i*3]]	, v, d)
		var b = find_vert(vertex_data[tag][cell[1][i*3 + 1]], v, d)
		var c = find_vert(vertex_data[tag][cell[1][i*3 + 2]], v, d)
		
		# print("a: ", a, " b: ", b, " c: ", c)

		a = Cube2Sphere.cube2sphere(a.x, a.y, a.z)
		b = Cube2Sphere.cube2sphere(b.x, b.y, b.z)
		c = Cube2Sphere.cube2sphere(c.x, c.y, c.z)

		verts.append(c)
		verts.append(b)
		verts.append(a)

		normals.append(c.normalized())
		normals.append(b.normalized())
		normals.append(a.normalized())

	return [verts, normals]

func vector_abs(v: Vector3) -> Vector3:
	return Vector3(abs(v.x), abs(v.y), abs(v.z))

func find_vert(edge_index, v: Array, d: Array) -> Vector3:
	var d1
	var d2

	match(edge_index & 0xFF):
		0x01:
			d1 = d[0b001] - threshold
			d2 = d[0b000] - threshold
			return v[1].linear_interpolate(v[0], 0.5)
		0x02:
			d1 = d[0b100] - threshold
			d2 = d[0b000] - threshold
			return v[4].linear_interpolate(v[0], 0.5)
		0x04:
			d1 = d[0b010] - threshold
			d2 = d[0b000] - threshold
			return v[2].linear_interpolate(v[0], 0.5)
		0x13:
			d1 = d[0b101] - threshold
			d2 = d[0b001] - threshold
			return v[5].linear_interpolate(v[1], 0.5)
		0x15:
			d1 = d[0b011] - threshold
			d2 = d[0b001] - threshold
			return v[3].linear_interpolate(v[1], 0.5)
		0x23:
			d1 = d[0b101] - threshold
			d2 = d[0b100] - threshold
			return v[5].linear_interpolate(v[4], 0.5)
		0x26:
			d1 = d[0b110] - threshold
			d2 = d[0b100] - threshold
			return v[6].linear_interpolate(v[4], 0.5)
		0x37:
			d1 = d[0b111] - threshold
			d2 = d[0b101] - threshold
			return v[7].linear_interpolate(v[5], 0.5)
		0x45:
			d1 = d[0b011] - threshold
			d2 = d[0b010] - threshold
			return v[3].linear_interpolate(v[2], 0.5)
		0x46:
			d1 = d[0b110] - threshold
			d2 = d[0b010] - threshold
			return v[6].linear_interpolate(v[2], 0.5)
		0x57:
			d1 = d[0b111] - threshold
			d2 = d[0b011] - threshold
			return v[7].linear_interpolate(v[3], 0.5)
		0x67:
			d1 = d[0b111] - threshold
			d2 = d[0b110] - threshold
			return v[7].linear_interpolate(v[6], 0.5)
		_:
			print("ERROR: Marching cubes edge ", edge_index, " undefined.")
			return Vector3(0.0, 0.0, 0.0)
